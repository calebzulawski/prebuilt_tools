# This file is generated by generate/generate.py; do not edit.

load("@rules_conda//conda/environment:defs.bzl", "lock_environments")
load("@rules_multirun//:defs.bzl", "multirun")

_PACKAGE_SPECS = {
    "autoconf": [
            "specs/autoconf/autoconf_2.69.yml",
            "specs/autoconf/autoconf_2.69_win.yml",
            "specs/autoconf/autoconf_2.71.yml",
            "specs/autoconf/autoconf_2.71_win.yml",
            "specs/autoconf/autoconf_2.72.yml",
        ],
    "automake": [
            "specs/automake/automake_1.14.yml",
            "specs/automake/automake_1.15.yml",
            "specs/automake/automake_1.16.yml",
            "specs/automake/automake_1.17.yml",
        ],
    "binutils": [
            "specs/binutils/binutils_1.0.yml",
            "specs/binutils/binutils_2.26.yml",
            "specs/binutils/binutils_2.27.yml",
            "specs/binutils/binutils_2.28.yml",
            "specs/binutils/binutils_2.30.yml",
            "specs/binutils/binutils_2.31.yml",
            "specs/binutils/binutils_2.32.yml",
            "specs/binutils/binutils_2.33.yml",
            "specs/binutils/binutils_2.34.yml",
            "specs/binutils/binutils_2.35.yml",
            "specs/binutils/binutils_2.36.yml",
            "specs/binutils/binutils_2.39.yml",
            "specs/binutils/binutils_2.40.yml",
            "specs/binutils/binutils_2.42.yml",
            "specs/binutils/binutils_2.43.yml",
            "specs/binutils/binutils_2.44.yml",
            "specs/binutils/binutils_2.45.yml",
        ],
    "bison": [
            "specs/bison/bison_3.0.yml",
            "specs/bison/bison_3.1.yml",
            "specs/bison/bison_3.4.yml",
            "specs/bison/bison_3.8.yml",
        ],
    "buildifier": [
            "specs/buildifier/buildifier_3.5.yml",
            "specs/buildifier/buildifier_4.0.yml",
            "specs/buildifier/buildifier_4.2.yml",
            "specs/buildifier/buildifier_5.0.yml",
            "specs/buildifier/buildifier_5.1.yml",
            "specs/buildifier/buildifier_6.0.yml",
            "specs/buildifier/buildifier_6.1.yml",
            "specs/buildifier/buildifier_6.3.yml",
            "specs/buildifier/buildifier_6.4.yml",
            "specs/buildifier/buildifier_7.1.yml",
            "specs/buildifier/buildifier_7.3.yml",
            "specs/buildifier/buildifier_8.0.yml",
            "specs/buildifier/buildifier_8.2.yml",
        ],
    "cmake": [
            "specs/cmake/cmake_3.14.yml",
            "specs/cmake/cmake_3.15.yml",
            "specs/cmake/cmake_3.16.yml",
            "specs/cmake/cmake_3.17.yml",
            "specs/cmake/cmake_3.18.yml",
            "specs/cmake/cmake_3.19.yml",
            "specs/cmake/cmake_3.20.yml",
            "specs/cmake/cmake_3.21.yml",
            "specs/cmake/cmake_3.22.yml",
            "specs/cmake/cmake_3.23.yml",
            "specs/cmake/cmake_3.24.yml",
            "specs/cmake/cmake_3.25.yml",
            "specs/cmake/cmake_3.26.yml",
            "specs/cmake/cmake_3.27.yml",
            "specs/cmake/cmake_3.28.yml",
            "specs/cmake/cmake_3.29.yml",
            "specs/cmake/cmake_3.30.yml",
            "specs/cmake/cmake_3.31.yml",
            "specs/cmake/cmake_4.0.yml",
            "specs/cmake/cmake_4.1.yml",
            "specs/cmake/cmake_4.2.yml",
        ],
    "doxygen": [
            "specs/doxygen/doxygen_1.10.yml",
            "specs/doxygen/doxygen_1.11.yml",
            "specs/doxygen/doxygen_1.12.yml",
            "specs/doxygen/doxygen_1.13.yml",
            "specs/doxygen/doxygen_1.8.yml",
            "specs/doxygen/doxygen_1.9.yml",
        ],
    "flex": [
            "specs/flex/flex_2.5.yml",
            "specs/flex/flex_2.6.yml",
        ],
    "grep": [
            "specs/grep/grep_3.10.yml",
            "specs/grep/grep_3.11.yml",
            "specs/grep/grep_3.12.yml",
            "specs/grep/grep_3.9.yml",
        ],
    "jq": [
            "specs/jq/jq_1.5.yml",
            "specs/jq/jq_1.6.yml",
            "specs/jq/jq_1.7.yml",
            "specs/jq/jq_1.8.yml",
        ],
    "m4": [
            "specs/m4/m4_1.4.yml",
            "specs/m4/m4_1.4_win.yml",
        ],
    "make": [
            "specs/make/make_4.2.yml",
            "specs/make/make_4.3.yml",
            "specs/make/make_4.4.yml",
        ],
    "meson": [
            "specs/meson/meson_0.45.yml",
            "specs/meson/meson_0.46.yml",
            "specs/meson/meson_0.47.yml",
            "specs/meson/meson_0.48.yml",
            "specs/meson/meson_0.49.yml",
            "specs/meson/meson_0.50.yml",
            "specs/meson/meson_0.51.yml",
            "specs/meson/meson_0.52.yml",
            "specs/meson/meson_0.53.yml",
            "specs/meson/meson_0.54.yml",
            "specs/meson/meson_0.55.yml",
            "specs/meson/meson_0.56.yml",
            "specs/meson/meson_0.57.yml",
            "specs/meson/meson_0.58.yml",
            "specs/meson/meson_0.59.yml",
            "specs/meson/meson_0.60.yml",
            "specs/meson/meson_0.61.yml",
            "specs/meson/meson_0.62.yml",
            "specs/meson/meson_0.63.yml",
            "specs/meson/meson_0.64.yml",
            "specs/meson/meson_1.0.yml",
            "specs/meson/meson_1.1.yml",
            "specs/meson/meson_1.10.yml",
            "specs/meson/meson_1.2.yml",
            "specs/meson/meson_1.3.yml",
            "specs/meson/meson_1.4.yml",
            "specs/meson/meson_1.5.yml",
            "specs/meson/meson_1.6.yml",
            "specs/meson/meson_1.7.yml",
            "specs/meson/meson_1.8.yml",
            "specs/meson/meson_1.9.yml",
        ],
    "ninja": [
            "specs/ninja/ninja_1.10.yml",
            "specs/ninja/ninja_1.11.yml",
            "specs/ninja/ninja_1.12.yml",
            "specs/ninja/ninja_1.13.yml",
            "specs/ninja/ninja_1.6.yml",
            "specs/ninja/ninja_1.7.yml",
            "specs/ninja/ninja_1.8.yml",
            "specs/ninja/ninja_1.9.yml",
        ],
    "pandoc": [
            "specs/pandoc/pandoc_1.16.yml",
            "specs/pandoc/pandoc_1.17.yml",
            "specs/pandoc/pandoc_1.18.yml",
            "specs/pandoc/pandoc_1.19.yml",
            "specs/pandoc/pandoc_2.0.yml",
            "specs/pandoc/pandoc_2.1.yml",
            "specs/pandoc/pandoc_2.10.yml",
            "specs/pandoc/pandoc_2.11.yml",
            "specs/pandoc/pandoc_2.12.yml",
            "specs/pandoc/pandoc_2.13.yml",
            "specs/pandoc/pandoc_2.14.yml",
            "specs/pandoc/pandoc_2.15.yml",
            "specs/pandoc/pandoc_2.16.yml",
            "specs/pandoc/pandoc_2.17.yml",
            "specs/pandoc/pandoc_2.18.yml",
            "specs/pandoc/pandoc_2.19.yml",
            "specs/pandoc/pandoc_2.2.yml",
            "specs/pandoc/pandoc_2.3.yml",
            "specs/pandoc/pandoc_2.4.yml",
            "specs/pandoc/pandoc_2.5.yml",
            "specs/pandoc/pandoc_2.6.yml",
            "specs/pandoc/pandoc_2.7.yml",
            "specs/pandoc/pandoc_2.8.yml",
            "specs/pandoc/pandoc_2.9.yml",
            "specs/pandoc/pandoc_3.1.yml",
            "specs/pandoc/pandoc_3.2.yml",
            "specs/pandoc/pandoc_3.3.yml",
            "specs/pandoc/pandoc_3.4.yml",
            "specs/pandoc/pandoc_3.5.yml",
            "specs/pandoc/pandoc_3.6.yml",
            "specs/pandoc/pandoc_3.7.yml",
            "specs/pandoc/pandoc_3.8.yml",
        ],
    "pkg-config": [
            "specs/pkg-config/pkg_config_0.28.yml",
            "specs/pkg-config/pkg_config_0.29.yml",
        ],
    "pkgconf": [
            "specs/pkgconf/pkgconf_2.2.yml",
            "specs/pkgconf/pkgconf_2.3.yml",
            "specs/pkgconf/pkgconf_2.4.yml",
            "specs/pkgconf/pkgconf_2.5.yml",
        ],
    "ruff": [
            "specs/ruff/ruff_0.0.yml",
            "specs/ruff/ruff_0.1.yml",
            "specs/ruff/ruff_0.10.yml",
            "specs/ruff/ruff_0.11.yml",
            "specs/ruff/ruff_0.12.yml",
            "specs/ruff/ruff_0.13.yml",
            "specs/ruff/ruff_0.14.yml",
            "specs/ruff/ruff_0.2.yml",
            "specs/ruff/ruff_0.3.yml",
            "specs/ruff/ruff_0.4.yml",
            "specs/ruff/ruff_0.5.yml",
            "specs/ruff/ruff_0.6.yml",
            "specs/ruff/ruff_0.7.yml",
            "specs/ruff/ruff_0.8.yml",
            "specs/ruff/ruff_0.9.yml",
        ],
    "yq": [
            "specs/yq/yq_2.10.yml",
            "specs/yq/yq_2.11.yml",
            "specs/yq/yq_2.12.yml",
            "specs/yq/yq_2.13.yml",
            "specs/yq/yq_2.14.yml",
            "specs/yq/yq_2.4.yml",
            "specs/yq/yq_2.5.yml",
            "specs/yq/yq_2.6.yml",
            "specs/yq/yq_2.7.yml",
            "specs/yq/yq_3.1.yml",
            "specs/yq/yq_3.2.yml",
            "specs/yq/yq_3.3.yml",
            "specs/yq/yq_3.4.yml",
        ],
}

def define_conda_locks(*, macos_version, glibc_version):
    update_targets = []
    lock_paths = []
    for package, specs in _PACKAGE_SPECS.items():
        target = package + "_lock"
        lock_paths.append("private/locks/" + package + ".lock")
        lock_environments(
            name = target,
            environments = specs,
            lockfile = "locks/" + package + ".lock",
            macos_version = macos_version,
            glibc_version = glibc_version,
        )
        update_targets.append(":" + target + ".update")
    multirun(
        name = "lock_all",
        commands = update_targets,
    )
    ensure_lockfiles(
        name = "init_lock_files",
        lockfiles = lock_paths,
    )

def _ensure_lockfiles_impl(ctx):
    script = ctx.actions.declare_file(ctx.label.name + "_runner.sh")
    script_lines = [
        "#!/usr/bin/env bash",
        "set -euo pipefail",
        'WORKSPACE_DIR="${BUILD_WORKSPACE_DIRECTORY:-$PWD}"',
    ]
    for lockfile in ctx.attr.lockfiles:
        script_lines.append("touch \"${WORKSPACE_DIR}/%s\"" % (lockfile))
    ctx.actions.write(script, "\n".join(script_lines), is_executable = True)
    return [DefaultInfo(executable = script)]

ensure_lockfiles = rule(
    implementation = _ensure_lockfiles_impl,
    attrs = {"lockfiles": attr.string_list()},
    executable = True,
)

